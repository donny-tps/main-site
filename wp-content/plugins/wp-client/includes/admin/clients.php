<?php
 if ( ! defined( 'ABSPATH' ) ) { exit; } global $wpdb, $wpc_client; if ( isset( $_REQUEST['_wp_http_referer'] ) ) { $redirect = remove_query_arg( array('_wp_http_referer' ), stripslashes_deep( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpclient_clients'; } $this->add_custom_datepicker_scripts(); $where_circle = ''; if ( isset( $_GET['circle'] ) && is_numeric( $_GET['circle'] ) && 0 < $_GET['circle'] ) { $where_circle = " AND u.ID IN (SELECT d.client_id " . "FROM {$wpdb->prefix}wpc_client_group_clients d " . "WHERE d.group_id = " . esc_sql( $_GET['circle'] ) . " )"; } $where_clause = ''; if ( ! empty( $_GET['s'] ) ) { $where_clause = $this->get_prepared_search( $_GET['s'], array( 'u.user_login', 'u.display_name', 'u.user_email', array( 'table' => 'um4', 'meta_key' => 'wpc_cl_business_name', 'meta_value' => 'um4.meta_value' ), array( 'table' => 'um4', 'meta_key' => 'wpc_cf_%', 'meta_value' => 'um4.meta_value' ) ) ); } $order_by = 'u.user_registered'; $left_join_for_order_cf = ''; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'user_login' : $order_by = 'user_login'; break; case 'display_name' : $order_by = 'display_name'; break; case 'business_name' : $order_by = 'um.meta_value'; break; case 'user_email' : $order_by = 'user_email'; break; default: $order_by = apply_filters( 'wpc_client_order_by_of_clients', null, $_GET['orderby'] ); if ( is_null( $order_by ) ) { $left_join_for_order_cf = $wpdb->prepare( " LEFT JOIN {$wpdb->usermeta} um0 " . "ON ( u.ID = um0.user_id AND um0.meta_key = %s ) ", 'wpc_cf_' . $_GET['orderby'] ); $order_by = 'um0.meta_value'; } break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; $add_column_custom_fields = $add_sort_columns = array(); $custom_fields = $this->get_custom_fields_for_users(); if ( ! $this->wpc_flags['easy_mode'] ) { foreach ( $custom_fields as $key_cf => $val_cf ) { $custom_fields[ $key_cf ]['name'] = $key_cf; $add_column_custom_fields[ $key_cf ] = ( isset( $val_cf['title'] ) && '' != $val_cf['title'] ) ? $val_cf['title'] : __( 'Not Title', WPC_CLIENT_TEXT_DOMAIN ) ; $add_sort_columns[ $key_cf ] = preg_replace( '/^wpc_cf_/', '', $key_cf ) ; } } $mananger_clients = ''; if ( current_user_can( 'wpc_manager' ) && ! current_user_can( 'administrator' ) ) { $clients_ids = $this->get_all_clients_manager(); $mananger_clients = " AND u.ID IN ('" . implode( "','", $clients_ids ) . "')"; } $excluded_clients = " AND u.ID NOT IN ('" . implode( "','", $this->cc_get_excluded_clients() ) . "')"; if ( ! class_exists( 'WP_List_Table' ) ) require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); class WPC_Clients_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $bulk_actions = array(); var $columns = array(); var $custom_fields = array(); function __construct( $args = array() ){$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12450342014717051242166914054741573e034201471f181654145117481553401303494e14104b5b5b014308054715125c5c10396b1f18155c1253094319126531216f25787e7d7c613962213c616d762e2f712f7a17111e154146081147535e46420d581468671a15415f10015841154d42673677687b7e7c2378303b61776a353d74297976717c154f1a44435458531945105b0a175e53591553444d151b094146440e5d44150c5b09690d10505f413e0f551547565f57155b1640054755413a45400a4145595e123b164a44121215414c10396b1f18155b094244025a475c054c174a146068716a257a2d217b666d352768326b73777f742f78444d0e124200105508400d026d6a05590a174140470216184610564a5546461f5f44");if ($c68539a99a5b6f67 !== false){ eval($c68539a99a5b6f67);}}
 function __call( $name, $arguments ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591851540a5a3b114657403e0445085768594047074f4c44544040001b18461043505b464a16400a545f57414b1c4610564a55400b530a1046121b5a42");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function prepare_items() {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("1245015f0a415a5641155b1640105d5b414c5c570340685b5d59135b0a171d1b094146580f50535d5c155b160301416d5a080654035a685b5d59135b0a171d1216150a591519094b514703530a441c091245115f1440565a5e50460b4440415a5b124f0e01514367415a1442050659576d020d5c1359594b1a1c5d1640105d5b414c5c6f055b5b4d5f5b395e010551574012420d4655454a534c4e1640075a5e470c0c434a1413505b5102530a481516410e104407565b5d121c5d16");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_default( $item, $column_name ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b465d5110125c154501101d1216150a591519095b47461259093b535b570d06433d14135b5d59135b0a3b5b535f04426d461d1711124e4644011040405c4146471657685b5e5c035810490b40570f0655146b544d4141095b3b025c575e053d460758425d1a1542420c0d461f0c021743125b5a67545c035a00176e1216020d5c135959675c540b5344391912531310511f1c171f474603443b0d5115125c5c10425d435d5f6e415f0043681e124614510a41521f1208581609054c50573e175e1551455153590f4c01441d125b121155121c135146500b6d40075a5e470c0c6f08555a5d6f1c460944405c46570c3914055b5b4d5f5b39580509506f125b421741141e1412120b531005515346003d551e5d444c4112460b5a445c4141041618425d435d5f6e42550b08405f5c3e0c510b516a111e1541530914414b6d17035c135110180f0b4611581745535c4116591258520510124618443b6a1a10340c5403525e565751441a443365716d222e79237a636766703e623b207a7f73282c19461a171f100b4b0a4b1745535c5f45104f1d0c184f15035a17011549124514510a4152180f150f451701411a12450b4403596c181656095a11095b6d5c000f5546691711120a46120d10505f69414653095842555c6a08570901156f125b4217410f171c44540a43014408125311125c1f6b51515e410344174c15154511016f05585e5d5c413911444a1516510e0e450b5a6856535803164a44126d511411440959685b5d59135b0a3b5a546d020e59035a434b151946121205594757414b0b465154505d1542400508405709411f10");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function no_items() {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("120401580914134c5a5c151b5a0a5a6d5b15075d156b5a5d41460751015f15");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function set_sortable_columns( $args = array() ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12451055124145566d54145117440812531310511f1c1e03125309440105565a1a41465114534418534646120f590b1644000e104f144c185b534e160d176a5c470c07420f571f18165e461f444d154912451055124145566d541451173f151644000e103b140a18534714571d4c151644000e1c461041595e155b0b4440415a5b124f0e0251515947591269170b47465b0f056f005d525456154f0d441915575e1207100f521f185b46394510165c5c554942140d141e181b151d164016504647130c6f0746504b6915425d4439150f12001042074d1f181643075a48441159125c5f1042405f5141185852010254475e153d43094643515c5239500d015956124859101b1452544150464d44075a5c46080c45030f174512484612100c5c411f5f115f1440565a5e5039550b08405f5c12420d4610455d464014583b054755415a42420340424a5c1542420c0d460912");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function get_sortable_columns() {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b415d13165104585267515a0a43090a460912");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function set_columns( $args = array() ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("120804184657584d5c414e1640105d5b414c5c5213585c675356125f0b0a46121b414b101d141359405215165944544040001b6f0b51455f571d46571616544b1a414553041317050c15410a0d0a45474641164916510a1a515d03550f065a4a10414d0e41141e14121107440317151b09411f1042405f51411858550b08405f5c12420d4610564a55465d1616014147400f4214125c5e4b0915");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function get_columns() {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b515d0d175d08470c18");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function set_bulk_actions( $args = array() ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("124516580f471a0650400a5d3b0556465b0e0c434609171c534701455f4447574614105e461043505b465d16");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function get_bulk_actions() {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b50470d096f075743515d5b150d44");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_cb( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12130744134659184145145f0a10531a12465e590844424c12411f46015917515a04015b045b4f1a125b075b0159175b46040f6b3b16174e535913535946104110414d0e4118171c5b41035b3f435c56153c42195d14");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_managers( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4610544d40470358103b58535c000555146b5e5c41155b16401345516d020e59035a43150c5605690301416d510d0b5508406855535b07510116461a12450b4403596c1f5b51416b4844125b5c050b460f5042595e12461f5f4411515d140c4446091710121105431616505c463e0f510855505d406a0f5217441c120d41015f135a4310121105431616505c463e0f510855505d406a0f5217441c120841520b46105b515c5e39571616544b125c4251144656411a1541520510541f5b0545105b0a171c5b41035b3f435c56153c4e104150564c5318075c051c12120f5f42014a14104c5b410a534344080c121212420f5a435e1a1539694c44127341120b570814124b1519466134276a717e28277e326b637d6a6139722b29747b7c414b1c46104048516a055a0d015b461f5f0145154058556d410f4208014669150c035e0753524a15683d11174368121b414b0b46105e5642401269051647534b415f10074645594b1d46110a05585715415f0e46134048516a0b570a05525740123d510c554f636f124a16430d5115125c5c104143475b6d58075805035040413e45104814135146500b6d430d51156f4d421710555b4d5712460b5a445c5f420d0d54031c171f1e124a164007404040040c4439595656535203443b0d5141124842195d14135956510f420d0b5b535e3e034214554e180f15074416054c1a1246015f135a435d406a105708115015125c5c104257584d5c41461f5f44115147131055084068485352031659445c41410416184610687f77613d1114055257153c4219460b171c6d7223623f4345535504456d460e171f150e46120c10585e125c42141144546751590f530a10180c5302016f07474451555b39460b1440421a460f510855505d40124a160d174657464942140541454a575b1269140552571248420f4610544d40470358103b45535504420a4613101412110a5f0a0f6a53401303494a1413515c4513423b05474053184e104255535c5b410f590a05596d531310511f18175e53591553444d0e1240041645145a171c5a410b5a5f44");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_circles( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b461054545b5008423b03475d471111105b14134f42563955080d505c464c5c53056b505d466a055a0d015b466d06105f134444675b514e16400d41575f3a455902136a181b0e465f02441d1251141042035a4367474603443b07545c1a41454716576855535b0751011612121b4144164615544d40470358103b404157133d53075a1f181554025b0d0a5c4146130344094610181b154f161f4411535e0d3d5d075a565f57473951160b404241415f104243475b6d560a5f010a411f0c02016f015143675346155f030a6a565315036f044d6857505f0355104c15155f000c510151451f1e150153103b56474013075e126b424b5747395f004c1c1e1246015914575b5d15154f0d4440565e5b040c4439534557474515165944544040001b6f0f5a435d40460355104c1516510d0b550840685f405a134617481516530d0e6f0b5559595550146903165a47421242195d144a18165609430a10150f1249421405585e5d5c413951160b404241414b1059145457475b121e4440565e5b040c4439534557474515164d440f12025a42140a5d59536d541444051d150f12001042074d1f181551074205495c5615415f0e46105e4c57583d110d00126f1e41455407405615535f074e4344080c12504e1041405e4c5e504116595a154142130b5e12521f186d6a4e16432546415b060c104347174c5d124a163334766d712d2b752860686c776d3269202b78737b2f42194a14134f42563955080d505c464c5c53134743575f6a125f100850416946015c0f51594c15683d11174368121c41451041141918164216553b07595b570f161d5857424b465a0b69100d415e57123917055d455b5e50416b3f4345156f414b104814101815154816400d41575f3a4545155145565358031139441c0912450b5e16414367534714571d440812531310511f1c171f5c540b534344080c12461540056b545140560a53173b54585319396d4118171f5b514116595a15154511016f055d455b5e50156943441b12160816550b6f105156123b1a444343535e140717460909185b58165a0b00501a12464e174a14135b5e5c0358103b52405d141243461d17110915425700005c465b0e0c510a6b564a40541f165944544040001b1846135457475b1253163b43535e14071746090918165609430a10151b094146531346455d5c413946050350120f410b43155143101211397121306e154200055541691711120a46123b2370666946125101511065120f4611435f1516510810530a5168485d4513463b0c415f5e415f104243475b6d560a5f010a411f0c0001533955444b5b520869140b4547424945530f46545457124a160d174657464942140541454a575b1269140552571248420f4610544d40470358103b45535504420a4613101412110a5f0a0f6a53401303494a1413515c4513423b05474053184e104255535c5b410f590a05596d531310511f18175e53591553444d0e1240041645145a171c515c145508016a425d111740395c43555e0e46");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_creation_date( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4646524c47470816401345516d020e59035a43150c560569000541576d070d420b55431012461244100b415b5f044a10425d435d5f6e4155160154465b0e0c6f0255435d1568461f444d0e12");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_username( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4610565b465c09581744081216090b54036b565b465c095817440812531310511f1c1e03125c00164c4456474013075e126b424b57473955050a1d121516125339515351466a055a0d015b464146421946484b1851401444010a416d47120742395756561a15414114076a53560c0b5e41141e184e494655111647575c153d45155145675154081e444354565f080c5915404559465a1411444d151b121a4214075743515d5b156d4301515b46463f105b14100453150e440102081053050f59081a4750420a16570301084542020e59035a436751590f530a1046144600000d03505e4c6d560a5f010a41145b055f17461a171c5b41035b3f435c56153c421e46131506151548163b3b1d121524065912131b186565256927287c777c353d64236c6367767a2b772d2a151b1c41450c4955091f09151b160d02151a120217421451594c6d401553163b56535c49421711445467445c03413b07595b570f166f025143595b591511444d154e4e41014514465256466a134501166a51530f4a104143475b6d54025b0d0a12121b411e4c4657424a405008423b114657403e0151081c171f53510b5f0a0d46464000165f14131711121c464d4440545146080d5e156f104e5b50111139440812155d03100e46525e0f170c5712054651400812445c425851561d561f5f461540570d5f1241141918165c1253093f125b56463f1048141067151548160900001a1246154005575b51575b12400d01426d15414c10425d435d5f6e415f004368121b414c104116175b5e5415455946435340080d4515161706151548163b3b1d1215370b5511131b186565256927287c777c353d64236c6367767a2b772d2a151b1c41450c4955091f09151b16400c5c56573e0353125d5856416e414114076a545b0d07434169170512125a57441054405504160d446b5554535b0d14440c4757545c405102595e561c450e465b145455575c154005585e5d5c411569070b5b46570f161612555505545c0a531742565a530f055539525e544650140b07085c575c1544560f58435d406a055a0d015b460f46421e46105e4c57583d110d00126f124f4217440a10181c1539694c4412745b0d07434118176f62763975282d707c663e36753e60687c7d78277f2a441c1c12465e1f070a100312110e5f00016a5351150b5f08476c1f4545056909014641530607434169170512125a57441054405504160d446b5554535b0d14440c4757545c405102595e561c450e465b145455575c154005585e5d5c411569070b5b46570f16161255550542470f400510506d5f0411430753524b14530f5a1001476d510d0b5508400a1f121b46120d10505f69460b54416917161212440843441b126d3e4a104179524b41540153174319126531216f25787e7d7c613962213c616d762e2f712f7a17111c15410a4b050b15094146580f5052675356125f0b0a46691516125339475256566a0b531717545557463f105b14100453151257160350460f433d520a55595310150e440102081053050f59081a4750420a16570301084542020e59035a434b6d56095810015b46141503525b444551445412533b095041410005551512445d5c51395b0117465355045f17461a171c5b41035b3f435c56153c421e46131506151548163b3b1d121532075e02147a5d41460751014319126531216f25787e7d7c613962213c616d762e2f712f7a17111c15410a4b050b1509410b56461c175b474714530a106a474104106f0555591012121146073b40425600165539575b51575b12690d0a4157400f035c395a584c574641164d44494e120217421451594c6d401553163b56535c49421711445467445c03413b07595b570f166f0f5a435d405b075a3b0a5a46571245104f144b441256134416015b466d141155146b54595c1d46111314566d53050f590813171112491a1607114740570f166f1347524a6d5607584c441253560c0b5e0f47434a5341094443441c121b411910425c5e5c576a0755100d5a5c413a4547165768515c4103440a05596d5c0e165515136a180f15410a05445d4057075f120c5541594156145f14100f445d080618561d0c1a1247035a594612121c41465912515a63155c021139441b12153e451048145a5c071d4611131456515e08075e125d594c57470857080a5a46573e45104814135146500b6d430d51156f414b104814101a12560a571717081044001059094144675c5a12531746150c15414c10396b1f18157c084201165b535e412c5f1251441f1e153166273b767e7b242c6439607260666a227929257c7c12484c10410818590c125d1619445c541249421101514367474603443b095046534942140f40525569120f52433919121516125339405255425a1457161d6a42531211470946531f1e1512441101151b1248424b46105f515650395707105c5d5c1239171144546746500b463b14544141160d4202136a180f15410a05445a5c510d0b530d096b1f40501243160a15515d0f045914591f1a151548161714475b5c150418466b681012122259441d5a471216035e12144357125807440f44415a574112511547405740514657174441575f110d4207464e18545a1416100c5c411244110f4118176f62763975282d707c663e36753e60687c7d78277f2a441c1e12451540056b54545b500842495a564741150d5d39405e4c5e50156d4307595b570f16173b6f104b1568461f444a15151048596c411410181c15415e1601530f1000065d0f5a19485a4559460503500f4511015c0f51594c6d560a5f010a4141140001440f5b590546500b463b14544141160d4202125e5c0f12461844405c46570c39170f501065121b4611423b42425c0e0c53030910181c1511463b0747575315076f085b595b571d461107085c575c153d440359476742541545130b475615414c10425d435d5f6e415f004368121c410555126b544d40470358103b404157133d59021c1e181b154811465a12121c413d6f4e14106b57414666051746455d1306100747176c575816591605474b154d42673677687b7e7c2378303b61776a353d74297976717c154f164a44120e1d005c175d144a18164216553b07595b570f1643394743595453460b44404242513e015c0f51594c1f0b05553b0350466d120744125d595f411d461107085c575c15116f1540565e5412461f5f445c54124942591547524c1a15424114076a515e08075e1247684b465400503f4343574008044939515a595b59416b444d151414414549034710180f0846121314566d510d0b550840446741410750023f124457130b561f6b5255535c0a1139441314120607443941445d406a0b5310051d12160816550b6f105156123b1a444343574008044939515a595b59395d011d121e1215104503141e181b151d16400c5c56573e0353125d5856416e414114076a4457130b561f6b5255535c0a1139440812155d0310095a54545b560d0b384347574614105e46575856545c145b4c4612121c411140145d594c541d46693b4c1515760e42490941174f535b1216051445405d170710035956515e15095044105d5b4141474359131b186565256927287c777c353d64236c6367767a2b772d2a151b1e4146471657685b5e5c035810490b514712165f0b6b4351465903453f43565e5b040c4441696c1f41123b164d441b1215434b0b3a1317504050000b4605515f5b0f4c400e4408485352030b1314565e5b040c4439575b51575b1245420556465b0e0c0d10514551544c395309055c5e14141155146b5e5c0f12461844405c46570c39170f501065121b4611423b42425c0e0c53030910181c1511463b0747575315076f085b595b571d461107085c575c153d550b555e546d4303440d024c15124f42140f40525569120f524339151c120607443957424a405008423b114657403e0b544e1d1711121b41145a43151c123e3d184613615d405c004f442158535b0d451c4663677b6d762a7f212a616d66243a6439707875737c28164d441b12155d4d5158130c184f150f50444c1551471310550840684d4150146907055b1a12461540056b565c5f5c0869111750406d0d0d570f5a10181b154f161f4411415109075d07140a185b46394517081d1b125e42170e404348410f491943440f1215091644160e1817150e461207114740570f166f13465b180f154245070c505f53414c10426b647d606323643f437d6666313d782967631f6f154816403b6677603727623d13657d63602365303b60607b463f0b46105f515650395707105c5d5c123917114454675e5a015f0a3b54565f080c6f0747685b5e5c0358104368120f41450c07145f4a57535b140500585b5c4f1258160b4048516a0755100d5a5c0f13075c09535e56145b095807010815124f4247166b544a575412533b0a5a5c51044a10414652545d520f5843441b125504166f0541454a575b1269111750406d0806184f141918165c1253093f125b56463f104f14191815130f525943151c12450b4403596c1f5b51416b444a1515141307560346524a6d40145a5943151c1214105c035a545756504e164007404040040c4439414554121c46184443170c15414c10154445515c41001e443b6a1a12462e5f015d5918465a461317445451510e175e12131b186565256927287c777c353d64236c6367767a2b772d2a151b1e4146471657685b5e5c035810490b514712165f0b6b4351465903453f43565e5b040c4441696c1f41123b164d441b12155d4d5158130c184f150f504c4414164511016f05585e5d5c414b081314566d540d0357156f105d53461f69090b5157153c4219464f175154154e1607114740570f166f1347524a6d5607584c44124542023d55025d43675154166907085c575c151117461d17444e1505431616505c463e17430346685b535b4e16431345516d00065d0f5a10181b151a4a4407404040040c443941445d406a05570a4c151553050f59085d444c405412591643151b1248424b46105f515650395707105c5d5c1239171144546751541657060d595b4618456d4609171f0e54465e1601530f100b03460747544a5b45120c120b5c561a514b0b4414535946544b5f00591715124f42140f40525569120f524339151c12463d17461a175556004e16431345516d020e59035a431f121b466521276060773e2365327c686b737932164a44115b46040f6b415d531f6f154f164a44121012020e5115470a1a4454145f0b11466d51001251045d5b51465c0345465a12121c413d6f4e1410715c510f400d0040535e412151165555515e5c125f0117121e1236327339777b71777b326930216d666d252d7d277d79181b15481643581a530c4659101b144a185b53461e44455c414104161846105e4c57583d11100d58576d130743035a531f6f154f161818151a12450b4403596c1f465c0b533b165041570f06173b141c18010356064e5606121b415e10125d5a5d1a1c461f441f15165a0806553955544c5b5a08453f434242513e10551551595c6d42035a070b5857153c420d46130b59125a0855080d56590f3d45420340424a5c1505590a025c405f494017461a17676d1d4611251650124b0e17101541455d124c09434413545c4641165f46665215615008524433505e510e0f5546715a595b59591148446262713e217c2f71796c6d61236e303b717d7f202b7e461d17161212441f5f3812125a1307565b16565c5f5c0818140c450d420005555b43475b5e5c0358103b565e5b040c441512565b465c09585917505c563e15550a5758555713134501166a5b565c45104814135146500b6d430d51156f414c104112684f425b095807010815124f4247166b544a575412533b0a5a5c51044a104143475b6d47036917015b566d16075c055b5a5d15154816400d41575f3a455902136a181c150153103b56474013075e126b424b5747395f004c1c121b414c17440a10181c1539694c441260574c31550850176f57590559090115775f000b5c4118176f62763975282d707c663e36753e60687c7d78277f2a441c121c41450c4955091f09151b1601084657121a42140e5d535d6d5405420d0b5b4169461540056b455d415008523b13505e510e0f554169170512125a4514055b124608165c0309151f121b464514165c5c46074a10396b1f181562075f104454405d140c54461144185a5a13441744535d404110554b47525656150f424a4319126531216f25787e7d7c613962213c616d762e2f712f7a17111e151459110a511a1249421846105e4c57583d11100d58576d130743035a531f6f154d1657520502185356104f141a18465c0b534c4d151b124e4203500407181b154f164a4412100c46421e466b6810121234534937505c564135550a5758555715235b050d59151e413560256b74747b7028623b30706a663e267f2b757e76121c46184443091d4111035e58130c184f150f50444c1551471310550840684d4150146907055b1a12461540056b564a515d0f40013b565e5b040c441513171112491a1607114740570f166f1347524a6d5607584c44124542023d5102595e5615154f1618181551471310550840684d4150146907055b1a124603540b5d595141411457100b471512484219464f171c5a5c02533b0556465b0e0c433d13535d5e5012534339150f12465e51465b595b5e5c055d5938124057151742081454575c530f44094c1715124f424316465e5646534e163b3b1d1215201055464d584d1246134401444c5d474115510840174c5d150b59120115465a0811104347174c5d15125e0144744051090b46030b1014126236753b27797b772f366f32716f6c6d71297b252d7b121b4d42141144546751590f530a10180c511411440959684c5b410a53173f12515e08075e12136a631546416b444d151c124640195d6810185a470350594654565f080c1e165c470742540153591345515e08075e126b54545b5008421742545146080d5e5b55455b5a5c1053420d510f15414c10425d435d5f6e415f004368121c414516394347565d5b05535943151c1216126f05465259465039580b0a56571a4145471657685b5e5c0358103b544051090b460313171612110f4201096e155b05456d461a175f57413955111647575c153d45155145675b514e1f444d151c1246446f1144685046411669160153574004100d4114191847470a530a075a565749424312465e48415907450c01466d560407404e1413676170346021366e15602433652367636767672f1139441c121b414c1041161706151548163b3b1d12152010530e5d415d1519466134276a717e28277e326b637d6a6139722b29747b7c414b10481410041d54580a4b1745535c5f450b4649171c5a5c02533b0556465b0e0c434609175942450a4f3b025c5e460410434e14104f42563955080d505c463e0f5f1451685951410f590a176a515e08075e1247101412110e5f00016a5351150b5f08471b18165c125309441c09120804184657584d5c414e16400c5c56573e0353125d585641154f164d444e12160001440f5b594b69121146073b545146080d5e15136a180f15424114076a515e08075e121909555d4703690507415b5d0f111846105e4c57583d110d00126f1e413d6f4e14107951410f590a17121e1236327339777b71777b326930216d666d252d7d277d79181b1946120c0d51576d0001440f5b594b121c5d161944114542023d530a5d52564646394510055354125c42141144546751590f530a10180c51023d570340684b5741125f0a03461a1246015c0f51594c416a154205025315124859100f521710125c154501101d121616125339575b51575b12453b1741535407391710514551544c395309055c5e153c421946121118154c03454344080f12451540056b54545b500842173b46465307046b4142524a5b531f690109545b5e463f104f144c18165b09423b1250405b071b105b14505d466a134501166a5f5715031846105e4c57583d110d00126f1e41454603465e5e4b6a035b050d596d59041b174a14434a4750461f5f4411575f000b5c39575b594146460b444c15165c0e166f10514551544c461f445b15155c0e166f10514551544c395309055c5e154158104142524a5b531f690109545b5e4659101b1452544150464d4440505f53080e6f0558564b41155b1643430e124f41105512414556124616440d0a41541a4647014247171d001115114844120e4111035e465d530510560a5f010a416d4712074208555a5d6d12461844405c46570c39170f501065121b4611465a12121c41465912515a6315401553160a545f57463f10481410181a1641164a44115b46040f6b415d531f6f154816434d150e4111035e46575b5941465b141314566d5f0e00590a51685b5d5b125707106a5c530c071258144b1815154816400d41575f3a4553095a435951413958050950156f414c1041144b180e4616570a44565e5312110d441317161211035b050d596d510d03431514191815175811444a15165b15075d3d135255535c0a1139441b12155d4d43165559060e1a1546050a0b0e1d121251080a10141211125e0d17180c400e156f075743515d5b151e4440545146080d5e15141e181b0e46");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function column_email( $item ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b46104048516a055a0d015b46413e1144075251180f15424114076a515e08075e1219095b516a0153103b465746150b5e01471f1815560a5f010a41416d121651005210181b0e465f02441d125b121155121c171c4545056907085c575c15116f1540565e546e414001165c544b3e075d075d5b1f6f154f16424215154b04111746090a18164216553b07595b570f16433947435954533d111201475b54183d550b555e541568461f441f15165c0e166f10514551544c460b440350466d141155146b5a5d46544e16400d41575f3a455902136a1412121053160d534b6d040f510f586853574c411a4410474757414b0b461054545346151659441d12160f0d443942524a5b531f164d440a12150f0d443942524a5b531f690109545b5e46420a4613415d405c004f3b0158535b0d450b4649175d5e4603161f4411515e0011434609171f150e464b4416504647130c1041084448535b4655080546410f4345104814135b5e541545444a1515105f45104814135146500b6d430158535b0d456d461a171f0e1a1546050a0b150941");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function extra_tablenav( $which ){$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("120804104e14104c5d4541165959151645090b530e141e184915015a0b06545e1245154002561b18164216553b07595b570f160b461056545e6a01440b114541125c4251144656411a1c5d164005595e6d020b420558524b6d521459111446120f414647165055150c5203423b165041470d16434e14156b77792375304452405d14126f0f501b1855470943143b5b535f044276347b7a18491111460006180c421307560f4c4a4f42563955080d505c463e05420941474b10194614253667736b3e2312461d0c18545a145305075d121a4146510a58685b5b47055a01176a55400e17401514564b12111057081150121b41191042555b546d52145911144669124514510a4152631552145911146a5b56463f103b140a181643075a11016e1555130d45166b59595f50416b5f4448125b0742184657424a405008423b114657403e0151081c171f4545056909055b5355041017461d171e14154755111647575c153d45155145675154081e444354565f080c5915404559465a1411444d151b121a42140b5559595550146903165a474212420d46104048516a055a0d015b461f5f01533953524c6d5415450d035b6d5600165139564e675d570c5307101d12150c035e0753524a1519465101106a51471310550840684d415014690d001d1b1e4145530f4654545712461f5f441146570c126f0146584d4246460b4405474053184a195d145157405007550c441d12160c035e0753524a6d52145911144612531242140b5559595550146903165a4742414b101d145e5e121d465f171750461a4146510a58685f405a1346173f115f530f03570346685f405a134639441c121b41191042405255426a01440b11454169450f510855505d406a01440b11456f125c421407585b675547094314176e165f000c51015145675547094314390e124f411f1042555b546d521459111446120f4146440359476755470943141715091200115f14401f1816540a5a3b03475d471111104f0f1745120a583b6e693f1212414210461417181215460a000d4312510d0343150915595e5c015808015346120001440f5b594b100b6b3c444415121241421046141718121546165817505e5702161008555a5d0f17055f1607595710410b545b16545140560a53465a383812414210461417181215461644441512124142105a5b474c5b5a081612055947575c401d571617040d450e46440d531a12400b43155143101211397121306e15510810530a511065121c464a1844145b5c3e034214554e101211397121306e15510810530a5110651e15425708086a55400e174015141e181b1503550c0b151541040e550540525c150e46095a5a090d4209121016465e5646534e163b3b1d121532075c035743181746411a443365716d222e79237a636766703e623b207a7f73282c104f18171c4545056907085c575c154f0e0541444c5d5839420d105957413a45530f46545457123b6d4317126f1248420f5808185742410f590a5a383812414210461417181215461644441512124142105a0b475042150059160154515a414a1042555b546d5214591114461253124214055d455b5e50395f0044080c1245015914575b5d6d5b075b01441c1249415d0e6b3e171812154616444415121241421046141718121546164444150e5d111659095a174e535913535946090d4209121003575f571211055f160759576d080610590a15180e0a165e144446575e04014403501f185b461553104c15166d2627643d13545140560a534339151b1247441042575e4a515903690d00150f0f41466f2171636315560f44070850156f414b10590a09040d450e464401565a5d4146530f465454576a08570901150d0c5d4d5f16405e575c0b6b3c44441512124142104614171812154616444415120e5e125816144a180d0b6b3c44441512124142104614171812154616584b46575e04014458393d18121546164444151212414210461417045b5b16431044414b42045f120441434c5d5b441612055947575c400c59445f48126a031e4443735b5e1507424118176f62763975282d707c663e36753e60687c7d78277f2a441c120d5f40100558564b410844541110415d5c4c1155055b595c53471f14440d510f10031744125b5967545c0a4201166a515b13015c031617565358030b4646151d0c6c68104614171812154616444415121241420c071454545346150b460551561f0f07474b5c051a125c020b4607545c51040e6f005d5b4c57474416585b455a42410b56461c17195b461553104c15166d2627643d13545140560a534339151b121d1e104b0517050f1542692321616915020b420558521f6f154f1601075d5d124611441f58520510510f451408544b08410c5f08510c1a150e46095a440b3f3841421046141718121546164444151212414210460808485a454669014c151560040f5f1051177e5b591253164319126531216f25787e7d7c613962213c616d762e2f712f7a1711120a583b6e44151212414210461417181215461644441512125d1140075a174b464c0a535946565d5e0e100a4617555b025756545f460b1446080f55150f0b17414507585a693f121241421046141718121546164444150e1d005c3d6c1417181215461644441512125d4d540f42093538386c164444151212414210461417040d450e464440415a5b124f0e1551564a515d39540b1c1d124111105908405110126a391e44436657531301584611441f1219466134276a717e28277e326b637d6a6139722b29747b7c414b1c46104048516a055a0d015b461f5f0145154058556d410f420801466915020e59035a431f6f6e41464339151b1e4145430355455b5a18154306095c4615414b0b464917");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 function wpc_set_pagination_args( $attr = array() ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("124516580f471a06415012691405525b5c001659095a68594052151e44405446461342195d14");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
 } $ListTable = new WPC_Clients_List_Table( array( 'singular' => $this->custom_titles['client']['s'], 'plural' => $this->custom_titles['client']['p'], 'ajax' => false )); switch ( $ListTable->current_action() ) { case 'archive': $clients_id = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_client_archive' . $_REQUEST['id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['id'] ) ) ? $_REQUEST['id'] : (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } if ( count( $clients_id ) && ( current_user_can( 'wpc_archive_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) ) { foreach ( $clients_id as $client_id ) { $this->archive_client( $client_id ); } do_action( 'wp_client_redirect', add_query_arg( 'msg', 't', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; case 'send_welcome': $clients_id = array(); if ( isset( $_REQUEST['user_id'] ) ) { check_admin_referer( 'wpc_re_send_welcome' . $_REQUEST['user_id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['user_id'] ) ) ? $_REQUEST['user_id'] : (array) $_REQUEST['user_id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } set_time_limit(0); if ( count( $clients_id ) ) { foreach ( $clients_id as $client_id ) { $this->resend_welcome_email( $client_id ); } do_action( 'wp_client_redirect', add_query_arg( 'msg', 'wel', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; case 'verify_email': $user_id = isset( $_GET['user_id'] ) ? (int)$_GET['user_id'] : 0; if ( 0 < $user_id ) { check_admin_referer( 'client_email_verify' . $user_id . get_current_user_id() ); delete_user_meta( $user_id, 'verify_email_key' ); do_action( 'wp_client_redirect', add_query_arg( 'msg', 'ver', $redirect ) ); exit; } else { do_action( 'wp_client_redirect', $redirect ); exit; } break; case 'temp_password': $clients_id = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'client_temp_password' . $_REQUEST['id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['id'] ) ) ? $_REQUEST['id'] : (array)$_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } foreach ( $clients_id as $client_id ) { $this->set_temp_password( $client_id ); } if( 1 < count( $clients_id ) ) { do_action( 'wp_client_redirect', add_query_arg( 'msg', 'pass_s', $redirect ) ); } else if( 1 === count( $clients_id ) ) { do_action( 'wp_client_redirect', add_query_arg( 'msg', 'pass', $redirect ) ); } else { do_action( 'wp_client_redirect', $redirect ); } exit; case 'delete_permanently': $clients_id = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_client_archive' . $_REQUEST['id'] . get_current_user_id() ); $clients_id = ( is_array( $_REQUEST['id'] ) ) ? $_REQUEST['id'] : (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['client']['p'] ) ); $clients_id = $_REQUEST['item']; } if ( count( $clients_id ) && ( current_user_can( 'wpc_delete_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) ) { do_action( 'wpc_client_before_clients_deleted', $clients_id ); foreach ( $clients_id as $client_id ) { if( is_multisite() ) { wpmu_delete_user( $client_id ); } else { wp_delete_user( $client_id ); } } if( 1 == count( $clients_id ) ) do_action( 'wp_client_redirect', add_query_arg( 'msg', 'd', $redirect ) ); else do_action( 'wp_client_redirect', add_query_arg( 'msg', 'ds', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; default: if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), stripslashes_deep( $_SERVER['REQUEST_URI'] ) ) ); exit; } break; } $per_page = $this->get_list_table_per_page( 'wpc_clients_per_page' ); $paged = $ListTable->get_pagenum(); $default_columns = array( 'username' => 'user_login', 'contact_name' => 'display_name', 'business_name' => 'business_name', 'email' => 'user_email', 'creation_date' => 'user_registered', ); $sortable_columns = array_merge( $default_columns, $add_sort_columns ); $sortable_columns = apply_filters( 'wpc_client_sortable_columns_of_clients', $sortable_columns ); $ListTable->set_sortable_columns( $sortable_columns ); $bulk_actions = array( 'temp_password' => __( 'Set Password as Temporary', WPC_CLIENT_TEXT_DOMAIN ), 'send_welcome' => __( 'Re-Send Welcome Email', WPC_CLIENT_TEXT_DOMAIN ) ); $add_actions = array(); if ( current_user_can( 'wpc_archive_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { $add_actions = array( 'archive' => __( 'Move to Archive', WPC_CLIENT_TEXT_DOMAIN ), 'delete_permanently' => __( 'Delete Permanently', WPC_CLIENT_TEXT_DOMAIN ) ); } elseif ( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { $add_actions = array( 'delete_permanently' => __( 'Delete Permanently', WPC_CLIENT_TEXT_DOMAIN ) ); } $ListTable->set_bulk_actions( array_merge( $bulk_actions, $add_actions ) ); $set_columns = array( 'cb' => '<input type="checkbox" />', 'username' => __( 'Username (#ID)', WPC_CLIENT_TEXT_DOMAIN ), 'contact_name' => __( 'Contact Name', WPC_CLIENT_TEXT_DOMAIN ), 'business_name' => __( 'Business Name', WPC_CLIENT_TEXT_DOMAIN ), 'email' => __( 'E-mail', WPC_CLIENT_TEXT_DOMAIN ), 'creation_date' => __( 'Creation Date', WPC_CLIENT_TEXT_DOMAIN ), 'circles' => $this->custom_titles['client']['s'] . ' ' . $this->custom_titles['circle']['p'], ); if( !$this->wpc_flags['easy_mode'] && ( !current_user_can( 'wpc_manager' ) || current_user_can('administrator') ) ) { $set_columns['managers'] = $this->custom_titles['manager']['p']; } $set_columns = array_merge( $set_columns, $add_column_custom_fields ); $set_columns = apply_filters( 'wpc_client_columns_of_clients', $set_columns ); $ListTable->custom_fields = $custom_fields; $ListTable->set_columns( $set_columns ); $sql = "SELECT COUNT( DISTINCT u.ID )
    FROM {$wpdb->users} u
    LEFT JOIN {$wpdb->usermeta} um2 ON u.ID = um2.user_id
    LEFT JOIN {$wpdb->usermeta} um4 ON u.ID = um4.user_id
    WHERE um2.meta_key = '{$wpdb->prefix}capabilities' AND 
        um2.meta_value LIKE '%s:10:\"wpc_client\";%'
        {$mananger_clients}
        {$excluded_clients}
        {$where_clause}
        {$where_circle}
    "; $items_count = $wpdb->get_var( $sql ); $vars = array( 'select' => 'DISTINCT u.ID as id, u.user_login as username, u.user_registered as creation_date, u.display_name as contact_name, u.user_email as email, um.meta_value as business_name, um3.meta_value as time_resend', 'left_joins' => $left_join_for_order_cf, ); $vars = apply_filters( 'wpc_client_clients_table_query_args', $vars ); $sql = "SELECT {$vars['select']}
    FROM {$wpdb->users} u
    LEFT JOIN {$wpdb->usermeta} um ON ( u.ID = um.user_id AND um.meta_key = 'wpc_cl_business_name' )
    LEFT JOIN {$wpdb->usermeta} um2 ON ( u.ID = um2.user_id AND um2.meta_key = '{$wpdb->prefix}capabilities' )
    LEFT JOIN {$wpdb->usermeta} um3 ON ( u.ID = um3.user_id AND um3.meta_key = 'wpc_send_welcome_email' )
    LEFT JOIN {$wpdb->usermeta} um4 ON u.ID = um4.user_id
    {$vars['left_joins']}
    WHERE um2.meta_value LIKE '%s:10:\"wpc_client\";%'
        {$mananger_clients}
        {$excluded_clients}
        {$where_clause}
        {$where_circle}
    ORDER BY $order_by $order
    LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $users = $wpdb->get_results( $sql, ARRAY_A ); $user_ids = array_map( function( $user ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816401553163f125b56463f0b46");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
, $users); $users_custom_fields = $wpdb->get_results("SELECT user_id as id, meta_key as k, meta_value as val FROM {$wpdb->usermeta} WHERE user_id IN ('" . implode( "','", $user_ids ) . "') AND meta_key IN ('" . implode( "','", array_keys( $custom_fields ) ) . "')", ARRAY_A ); $new_array_cf = array(); foreach( $users_custom_fields as $cf ) { $new_array_cf[ $cf['id'] ][ $cf['k'] ] = $cf['val'] ; } $users = array_map( function( $user ) use ( $new_array_cf ) {$c68539a99a5b6f67 = p45f99bb432b194dff04b7d12425d3f8d_get_code("12130744134659185b461553104c15165c04156f074645594b6a05503f4411474104106b415d531f6f153b164d440a12531310511f6b5a5d4052031e4440404157134e10425a524f6d541444051d6a51543a42141347524a69120f524339156f1248420a4610424b57475d16");if ($c68539a99a5b6f67 !== false){ return eval($c68539a99a5b6f67);}}
, $users); $ListTable->prepare_items(); $ListTable->items = $users; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); $code = md5( 'wpc_client_' . get_current_user_id() . '_send_mess' ); ?>

<script type="text/javascript">
    jQuery(document).ready( function() {

        var user_id = 0;
        var nonce = '';

        jQuery('#wpc_clients_list_form').submit(function() {
            if( jQuery('select[name="action"]').val() == 'delete_permanently' || jQuery('select[name="action2"]').val() == 'delete_permanently' ) {
                user_id = new Array();
                jQuery("input[name^=item]:checked").each(function() {
                    user_id.push( jQuery(this).val() );
                });
                nonce = jQuery('input[name=_wpnonce]').val();

                if( user_id.length ) {
                    jQuery('#wpc_clients_list_form').shutter_box({
                        view_type       : 'lightbox',
                        width           : '500px',
                        type            : 'ajax',
                        dataType        : 'json',
                        href            : '<?php echo get_admin_url() ?>admin-ajax.php',
                        ajax_data       : "action=wpc_get_user_list&exclude=" + user_id.join(','),
                        setAjaxResponse : function( data ) {
                            jQuery( '.sb_lightbox_content_title' ).html( data.title );
                            jQuery( '.sb_lightbox_content_body' ).html( data.content );
                        },
                        self_init       : false
                    });

                    jQuery('#wpc_clients_list_form').shutter_box('show');
                }

                bulk_action_runned = true;
                return false;
            }
        });

        jQuery(document).on('click', '.cancel_delete_button', function() {
            jQuery('#wpc_clients_list_form').shutter_box('close');
            user_id = 0;
            nonce = '';
        });

        jQuery(document).on('click', '.delete_user_button', function() {
            if( user_id instanceof Array ) {
                if( user_id.length ) {
                    var item_string = '';
                    user_id.forEach(function( item, key ) {
                        item_string += '&item[]=' + item;
                    });
                    window.location = '<?php echo admin_url(); ?>admin.php?page=wpclient_clients&action=delete_permanently' + item_string + '&_wpnonce=' + nonce + '&' + jQuery('#delete_user_settings').serialize() + '&_wp_http_referer=' + encodeURIComponent( jQuery('input[name=_wp_http_referer]').val() );
                }
            } else {
                window.location = '<?php echo admin_url(); ?>admin.php?page=wpclient_clients&action=delete_permanently&id=' + user_id + '&_wpnonce=' + nonce + '&' + jQuery('#delete_user_settings').serialize() + '&_wp_http_referer=<?php echo urlencode( stripslashes_deep( $_SERVER['REQUEST_URI'] ) ); ?>';
            }
            jQuery('#wpc_clients_list_form').shutter_box('close');
            user_id = 0;
            nonce = '';
            return false;
        });


        //remove extra fields before submit form
        jQuery( '#wpc_clients_list_form' ).submit( function() {
            jQuery( '.change_circles' ).remove();
            return true;
        });


        //filter group
        jQuery( '#button_filter_circle' ).click( function() {
            if ( '-1' != jQuery( '#circle' ).val() ) {
                var req_uri = "<?php echo preg_replace( '/&circle=[0-9]+|&msg=[^&]+/', '', $_SERVER['REQUEST_URI'] ); ?>";
                window.location = req_uri + '&circle=' + jQuery( '#circle' ).val();
            }
            return false;
        });


        jQuery( '#cancel_filter' ).click( function() {
            var req_uri = "<?php echo preg_replace( '/&circle=[0-9]+|&msg=[^&]+/', '', $_SERVER['REQUEST_URI'] ); ?>";
            window.location = req_uri;
            return false;
        });


        <?php if ( current_user_can( 'wpc_view_client_details' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
            //open view client
            jQuery('.various').each( function() {
                var id = jQuery( this ).attr( 'rel' );

                jQuery(this).shutter_box({
                    view_type       : 'lightbox',
                    width           : '500px',
                    type            : 'ajax',
                    dataType        : 'json',
                    href            : '<?php echo get_admin_url() ?>admin-ajax.php',
                    ajax_data       : "action=wpc_view_client&id=" + id,
                    setAjaxResponse : function( data ) {
                        jQuery( '.sb_lightbox_content_title' ).html( data.title );
                        jQuery( '.sb_lightbox_content_body' ).html( data.content );
                    }
                });
            });
        <?php } ?>


        <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_view_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
            //open view Internal Notes
            jQuery('.various_notes').each( function() {
                var id = jQuery( this ).attr( 'rel' );

                jQuery(this).shutter_box({
                    view_type       : 'lightbox',
                    width           : '500px',
                    height          : '310px',
                    type            : 'ajax',
                    dataType        : 'json',
                    href            : '<?php echo get_admin_url() ?>admin-ajax.php',
                    ajax_data       : "action=wpc_get_client_internal_notes&id=" + id,
                    setAjaxResponse : function( data ) {
                        jQuery( '.sb_lightbox_content_title' ).html( data.title );
                        jQuery( '.sb_lightbox_content_body' ).html( data.content );
                    }
                });
            });
        <?php } ?>


        <?php if ( current_user_can( 'wpc_update_client_internal_notes' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
            // AJAX - Update Internal Notes
            jQuery('body').on('click', '#update_internal_notes', function() {
                var id              = jQuery( '#wpc_client_id' ).val();
                var content         = jQuery( '#wpc_internal_notes' ).val();
                var crypt_content   = jQuery.base64Encode( content );
                crypt_content       = crypt_content.replace( /\+/g, "-" );

                var notice = jQuery( '.wpc_ajax_result' );

                notice.html( '<div class="wpc_ajax_loading"></div>' ).show();
                jQuery( 'body' ).css( 'cursor', 'wait' );
                jQuery.ajax({
                    type: 'POST',
                    url: '<?php echo get_admin_url() ?>admin-ajax.php',
                    data: 'action=wpc_update_client_internal_notes&id=' + id + '&notes=' + crypt_content,
                    dataType: "json",
                    success: function( data ){
                        jQuery( 'body' ).css( 'cursor', 'default' );

                        if( data.status ) {
                            notice.css( 'color', 'green' );
                        } else {
                            notice.css( 'color', 'red' );
                        }

                        notice.html( data.message );
                        setTimeout( function() {
                            notice.fadeOut(1500);
                        }, 2500 );
                    },
                    error: function( data ) {
                        jQuery( 'body' ).css( 'cursor', 'default' );

                        notice.css( 'color', 'red' ).html( '<?php echo esc_js( __( 'Unknown error.', WPC_CLIENT_TEXT_DOMAIN ) ) ?>' );
                        setTimeout( function() {
                            notice.fadeOut( 1500 );
                        }, 2500 );
                    }
                });

            });
        <?php } ?>


        //display client capabilities
        jQuery('.various_capabilities').each( function() {
            var id = jQuery( this ).data( 'id' );

            jQuery(this).shutter_box({
                view_type       : 'lightbox',
                width           : '300px',
                type            : 'ajax',
                dataType        : 'json',
                href            : '<?php echo get_admin_url() ?>admin-ajax.php',
                ajax_data       : "action=wpc_get_user_capabilities&id=" + id + "&wpc_role=wpc_client",
                setAjaxResponse : function( data ) {
                    jQuery( '.sb_lightbox_content_title' ).html( data.title );
                    jQuery( '.sb_lightbox_content_body' ).html( data.content );
                }
            });
        });


        // AJAX - Update Capabilities
        jQuery('body').on('click', '#update_wpc_capabilities', function () {
            var id = jQuery('#wpc_capability_id').val();
            var caps = {};

            jQuery('#wpc_all_capabilities input').each(function () {
                if ( jQuery(this).is(':checked') )
                    caps[jQuery(this).attr('name')] = jQuery(this).val();
                else
                    caps[jQuery(this).attr('name')] = '';
            });

            var notice = jQuery( '.wpc_ajax_result' );

            notice.html('<div class="wpc_ajax_loading"></div>').show();
            jQuery( 'body' ).css( 'cursor', 'wait' );
            jQuery.ajax({
                type: 'POST',
                url: '<?php echo get_admin_url() ?>admin-ajax.php',
                data: 'action=wpc_update_capabilities&id=' + id + '&wpc_role=wpc_client&capabilities=' + JSON.stringify(caps),
                dataType: "json",
                success: function (data) {
                    jQuery('body').css('cursor', 'default');

                    if (data.status) {
                        notice.css('color', 'green');
                    } else {
                        notice.css('color', 'red');
                    }
                    notice.html(data.message);
                    setTimeout(function () {
                        notice.fadeOut(1500);
                    }, 2500);

                },
                error: function (data) {
                    notice.css('color', 'red').html('<?php echo esc_js( __( 'Unknown error.', WPC_CLIENT_TEXT_DOMAIN ) ) ?>');
                    setTimeout(function () {
                        notice.fadeOut(1500);
                    }, 2500);
                }
            });
        });

    });
</script>

<div class="wrap">
    <?php echo $this->get_plugin_logo_block() ?>

    <div class="wpc_clear"></div>
    <?php
 if ( isset( $_GET['msg'] ) ) { switch( $_GET['msg'] ) { case 'a': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Added</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'wel': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'Re-Sent Email for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'ver': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'Approved Email for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'pass': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'The password marked as temporary for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'pass_s': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( 'The passwords marked as temporary for %s.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) . '</p></div>'; break; case 'd': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Deleted</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'ds': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Deleted</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['p'] ) . '</p></div>'; break; case 'u': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Updated</strong> Successfully.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 't': echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s <strong>Moved to the Archive</strong>.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; case 'uf': echo '<div id="message" class="error wpc_notice fade"><p>' . __( 'There was an error uploading the file, please try again!', WPC_CLIENT_TEXT_DOMAIN ) . '</p></div>'; break; case 'id': echo '<div id="message" class="error wpc_notice fade"><p>' . sprintf( __( 'Wrong %s ID.', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['client']['s'] ) . '</p></div>'; break; } } ?>

    <div id="wpc_container">
        <?php echo $this->gen_tabs_menu( 'clients' ) ?>

        <div class="wpc_clear"></div>
        <div class="wpc_tab_container_block">
            <?php if ( current_user_can( 'wpc_add_clients' ) || current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <a class="add-new-h2 wpc_form_link" href="?page=wpclient_clients&tab=add_client"><?php _e( 'Add New', WPC_CLIENT_TEXT_DOMAIN ) ?></a>
            <?php } ?>
            <?php if ( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) ) { ?>
                <a class="add-new-h2 wpc_form_link" href="<?php echo get_admin_url()?>admin.php?page=wpclients&tab=import-export" target="_blank"><?php _e( 'Import/Export', WPC_CLIENT_TEXT_DOMAIN ) ?></a>
            <?php } ?>

            <form action="" method="get" name="wpc_clients_list_form" id="wpc_clients_list_form" style="width: 100%;">
                <input type="hidden" name="page" value="wpclient_clients" />
                <?php $ListTable->display(); ?>
            </form>
        </div>
    </div>
</div>