<?php
 if ( ! defined( 'ABSPATH' ) ) { exit; } if ( !current_user_can( 'wpc_admin' ) && !current_user_can( 'administrator' ) && !current_user_can( 'view_others_clientspages' ) && !current_user_can( 'edit_others_clientspages' ) ) { if ( current_user_can( 'view_others_portalhubs' ) || current_user_can( 'edit_others_portalhubs' ) ) $adress = 'admin.php?page=wpclients_content&tab=portalhubs'; else $adress = 'admin.php?page=wpclients_content&tab=files'; do_action( 'wp_client_redirect', get_admin_url() . $adress ); } global $wpdb; if ( isset($_REQUEST['_wp_http_referer']) ) { $redirect = remove_query_arg(array('_wp_http_referer' ), wp_unslash( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpclients_content'; } if ( isset( $_GET['action'] ) ) { switch ( $_GET['action'] ) { case 'trash': $pp_ids = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_portal_page_trash' . $_REQUEST['id'] . get_current_user_id() ); $pp_ids = (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['portal_page']['p'] ) ); $pp_ids = $_REQUEST['item']; } if ( count( $pp_ids ) ) { foreach ( $pp_ids as $pp_id ) { $type = $wpdb->get_var( $wpdb->prepare( "SELECT post_status FROM {$wpdb->posts} WHERE ID = '%d'", $pp_id ) ); if( $type ) add_post_meta( $pp_id, 'wpc_hubpage_old_status', $type ) ; $wpdb->update( $wpdb->posts , array( 'post_status' => 'trash' ), array( 'ID' => $pp_id ) ); } do_action( 'wp_client_redirect', add_query_arg( 'trashed', count( $pp_ids ), $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; case 'untrash': $pp_ids = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_portal_page_untrash' . $_REQUEST['id'] . get_current_user_id() ); $pp_ids = (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['portal_page']['p'] ) ); $pp_ids = $_REQUEST['item']; } if ( count( $pp_ids ) ) { foreach ( $pp_ids as $pp_id ) { $new_status = get_post_meta( $pp_id, 'wpc_hubpage_old_status', true ) ; $wpdb->update( $wpdb->posts , array( 'post_status' => $new_status ), array( 'ID' => $pp_id ) ); } do_action( 'wp_client_redirect', add_query_arg( 'untrashed', count( $pp_ids ), $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; case 'delete': $pp_ids = array(); if ( isset( $_REQUEST['id'] ) ) { check_admin_referer( 'wpc_portal_page_delete' . $_REQUEST['id'] . get_current_user_id() ); $pp_ids = (array) $_REQUEST['id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( $this->custom_titles['portal_page']['p'] ) ); $pp_ids = $_REQUEST['item']; } if ( count( $pp_ids ) ) { foreach ( $pp_ids as $pp_id ) { wp_delete_post( $pp_id ); $this->cc_delete_all_object_assigns( 'portal_page', $pp_id ); } do_action( 'wp_client_redirect', add_query_arg( 'deleted', count( $pp_ids ), $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; break; } } if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), wp_unslash( $_SERVER['REQUEST_URI'] ) ) ); exit; } $visible_status = array( 'trash', 'publish', 'future', 'draft', 'pending', 'private' ); $where_status = ''; if( !empty( $_GET['filter_status'] ) && in_array( $_GET['filter_status'], $visible_status ) ) { $where_status = " AND p.post_status = '" . esc_sql( $_GET['filter_status'] ) . "'"; } else { $for_all_visible_status = $visible_status; array_shift( $for_all_visible_status ); $where_status = " AND p.post_status IN ('" . implode( "','", $for_all_visible_status ) . "') "; } $where_clause = ''; if( !empty( $_GET['s'] ) ) { $where_clause = $this->get_prepared_search( $_GET['s'], array( 'p.post_title', ) ); } if( !empty( $_GET['tag'] ) ) { $post_ids = get_objects_in_term( $_GET['tag'], 'wpc_tags' ); if( is_array( $post_ids ) && count( $post_ids ) ) { $where_clause .= " AND p.ID IN (" . implode( ', ', $post_ids ) . ")"; } else { $where_clause .= " AND 0 = 1"; } } $where_manager = ''; if( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) ) { $manager_id = get_current_user_id(); $manager_clients = $this->cc_get_assign_data_by_object( 'manager', $manager_id, 'client' ); $manager_groups = $this->cc_get_assign_data_by_object( 'manager', $manager_id, 'circle' ); $clients_groups = array(); foreach ( $manager_groups as $group_id ) { $clients_groups = array_merge( $clients_groups, $this->cc_get_group_clients_id( $group_id ) ); } $manager_all_clients = array_unique( array_merge( $manager_clients, $clients_groups ) ); $groups_clients = array(); foreach ( $manager_clients as $client_id ) { $groups_clients = array_merge( $groups_clients, $this->cc_get_client_groups_id( $client_id ) ); } $manager_all_groups = array_unique( array_merge( $manager_groups, $groups_clients ) ); $post_of_clients = $this->cc_get_assign_data_by_assign( 'portal_page', 'client', $manager_all_clients ); $post_of_groups = $this->cc_get_assign_data_by_assign( 'portal_page', 'circle', $manager_all_groups ); $cat_of_clients = $this->cc_get_assign_data_by_assign( 'portal_page_category', 'client', $manager_all_clients ); $cat_of_groups = $this->cc_get_assign_data_by_assign( 'portal_page_category', 'circle', $manager_all_groups ); $all_cats = array_unique( array_merge( $cat_of_clients, $cat_of_groups ) ); $posts_of_cats = $wpdb->get_col( "SELECT p.ID FROM {$wpdb->posts} p INNER JOIN {$wpdb->postmeta} pm ON ( p.ID = pm.post_id AND pm.meta_key = '_wpc_category_id' AND pm.meta_value IN ('" . implode( "','", $all_cats ) . "') ) WHERE p.post_type = 'clientspage'" ); $manager_all_post = array_unique( array_merge( $post_of_clients, $post_of_groups, $posts_of_cats ) ); $where_manager = " AND ( p.ID IN ('" . implode( "','", $manager_all_post ) . "') OR p.post_author = '" . get_current_user_id() . "' )" ; unset( $manager_clients, $manager_all_clients, $manager_groups, $manager_all_groups, $clients_groups, $groups_clients, $post_of_clients, $post_of_groups, $cat_of_clients, $cat_of_groups, $all_cats, $posts_of_cats, $manager_all_post ); } $where_cat = ''; if( isset( $_GET['wpc_pp_category'] ) && (int)$_GET['wpc_pp_category'] ) { $search_text = (int)$_GET['wpc_pp_category']; $where_cat = " AND cppc.cat_id = '" . $search_text . "'"; } $where_date = ''; $m = ( isset( $_GET['m'] ) ) ? (int)$_GET['m'] : 0 ; if ( 0 < $m && 6 == strlen( $m ) ) { $year = substr( $m, 0, 4 ); $month = substr( $m, 4, 6 ); $next_month = (int) $month + 1; $where_date = " AND p.post_modified > '{$year}-{$month}-01 00:00:00' AND p.post_modified < '{$year}-{$next_month}-01 00:00:00'"; } $order_by = 'p.ID'; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'date' : $order_by = 'p.post_modified'; break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; if( ! class_exists( 'WP_List_Table' ) ) { require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); } class WPC_Portalpages_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $actions = array(); var $bulk_actions = array(); var $columns = array(); function __construct( $args = array() ){$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12450342014717051242166914054741573e034201471f181654145117481553401303494e14104b5b5b014308054715125c5c10396b1f18155c1253094319126531216f25787e7d7c613962213c616d762e2f712f7a17111e154146081147535e46420d581468671a15415f10015841154d42673677687b7e7c2378303b61776a353d74297976717c154f1a44435458531945105b0a175e53591553444d151b094146440e5d44150c5b09690d10505f413e0f551547565f57155b1640054755413a45400a4145595e123b164a44121215414c10396b1f18155b094244025a475c054c174a146068716a257a2d217b666d352768326b73777f742f78444d0e124200105508400d026d6a05590a174140470216184610564a5546461f5f44");if ($c223def527cafb5d !== false){ eval($c223def527cafb5d);}}
 function __call( $name, $arguments ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591851540a5a3b114657403e0445085768594047074f4c44544040001b18461043505b464a16400a545f57414b1c4610564a55400b530a1046121b5a42");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function prepare_items() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1245015f0a415a5641155b1640105d5b414c5c570340685b5d59135b0a171d1b094146580f50535d5c155b16051647534b494b0b46104457404107540801150f124516580f471a0655501269170b474653030e5539575854475808454c4d0e1216150a5915190967515a0a43090a6a5a570006551447170512541444051d1d1216020d5c1359594b1e15425e0d0051575c4d4214155b454c53570a53444d0e12");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_default( $item, $column_name ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12080418465d444b57414e16400d41575f3a4214055b5b4d5f5b3958050950126f414b104f144c1840501243160a15165b15075d3d14135b5d59135b0a3b5b535f04426d5d144a1857591553441f1540571517420814101f09151b16");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function no_items() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("120401580914134c5a5c151b5a0a5a6d5b15075d156b5a5d41460751015f15");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function set_sortable_columns( $args = array() ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12451055124145566d54145117440812531310511f1c1e03125309440105565a1a41465114534418534646120f590b1644000e104f144c185b534e160d176a5c470c07420f571f18165e461f444d154912451055124145566d541451173f151644000e103b140a18534714571d4c151644000e1c461041595e155b0b4440415a5b124f0e0251515947591269170b47465b0f056f005d525456154f0d441915575e1207100f521f185b46394510165c5c554942140d141e181b151d164016504647130c6f0746504b6915425d4439150f12001042074d1f181643075a48441159125c5f1042405f5141185852010254475e153d43094643515c5239500d015956124859101b1452544150464d44075a5c46080c45030f174512484612100c5c411f5f115f1440565a5e5039550b08405f5c12420d4610455d464014583b054755415a42420340424a5c1542420c0d460912");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function get_sortable_columns() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b415d13165104585267515a0a43090a460912");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function set_columns( $args = array() ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("120804184657584d5c414e1640105d5b414c5c5213585c675356125f0b0a46121b414b101d141359405215165944544040001b6f0b51455f571d46571616544b1a414553041317050c15410a0d0a45474641164916510a1a515d03550f065a4a10414d0e41141e14121107440317151b09411f1042405f51411858550b08405f5c12420d4610564a55465d1616014147400f4214125c5e4b0915");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function get_columns() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b515d0d175d08470c18");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function set_actions( $args = array() ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("124516580f471a065356125f0b0a46120f414651145344031247034211165b1216150a59150f17");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function get_actions() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b5351150b5f08470c18");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function set_bulk_actions( $args = array() ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("124516580f471a0650400a5d3b0556465b0e0c434609171c534701455f4447574614105e461043505b465d16");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function get_bulk_actions() {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("121307441346591816410e5f17490b50470d096f075743515d5b150d44");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_cb( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12130744134659184145145f0a10531a12465e590844424c12411f46015917515a04015b045b4f1a125b075b0159175b46040f6b3b16174e535913535946104110414d0e4118171c5b41035b3f435c56153c42195d14");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_title( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4610565b465c095817440812531310511f1c1e03125c00164c445c41410416184610687f77613d11020d594657133d431255434d41123b164d4413141246164207475f1f12085b16403b7277663a45560f58435d406a154205104041153c4219464f175154154e1607114740570f166f1347524a6d5607584c4412575608166f09405f5d40463955080d505c461212510151441f121c461f441f151653021659095a4463154008421605465a153c420d46130b59125d145302591753560c0b5e48445f480d45075101594242510d0b5508404467515a0842010a411453021659095a0a4d5c411457170c135b565c45104814135146500b6d430d51156f414c104112684f425b095807010815124f4247166b544a575412533b0a5a5c51044a104143475b6d4509441005596d420005553941594c4054155e43441b12160816550b6f105156123b164a445257463e014514465256466a134501166a5b56494b104f14191815133941143b5d4646113d420352524a57475b11444a1547400d075e055b535d1a1511463b115b415e0011584e1413676170346021366e15602433652367636767672f1139441c121b414c104116174c5b410a53594612121c410743056b564c46474e163b3b1d1215330743125b455d12410e5f17445c46570c4256145b5a18465d0316301654415a464e103164746771792f732a306a667739366f227b7a797b7b461f444d151c12464010460a10181c1539694c4412605712165f14511014126236753b27797b772f366f32716f6c6d71297b252d7b121b414c10410818590c125d16400556465b0e0c433d13535d5e5012534339150f12465e51465c455d5408445700095c5c1c110a405944565f5708114607085c575c15116f055b594c575b12100507415b5d0f5f540358524c57130f525943151c12450b4403596c1f5b51416b444a1515143e1540085b595b570841164a4442426d021055074052675c5a0855014c15154511016f165b454c535939460503506d56040e55125110181c15425f10015869150806173b1419185550126907114740570f166f1347524a6d5c021e4d441c121c414516394347675a4112463b165054571307425b1317161240145a010a565d56044a101144684d5c460a57170c1d12163e31753462726a6912347335317061663e37622f136a181b154f164a44121012150b440a510a1a151548160117566d531516424e1468671a15417201085046574116580f47175146500b161401475f530f075e12584e1f1e153166273b767e7b242c6439607260666a227929257c7c12484219461a171f10155811444a156d6d49421722515b5d46504666011658535c040c440a4d1014126236753b27797b772f366f32716f6c6d71297b252d7b121b414c10410818590c125d1619444812570d1155464f175154154e1607114740570f166f1347524a6d5607584c4412575608166f09405f5d40463955080d505c461212510151441f121c461f441f151653021659095a44631550025f104368120f41450c07145f4a57535b14140b46461c110a405944584b460841164a44115b46040f6b415d531f6f1548164342545146080d5e5b515351461746420d1059570f4345104814524b516a074210161d126d3e4a10417153514615125e0d17155b46040f17461d1711121b4611465a12121c413d6f4e14107d565c121148446262713e217c2f71796c6d61236e303b717d7f202b7e461d171612125a19055a120912450353125d5856416e41520108504657463f105b14100453150e440102081053050f59081a4750420a16570301084542020e59035a434b6d56095810015b46140001440f5b5905464707450c425c560f46421e46105e4c57583d110d00126f124f4217406b40485c5a0855015912121c4115403957455d534103690a0b5b515749421711445467425a144205086a425306076f1246564b5a12461844405c46570c39170f501065121b465101106a51471310550840684d415014690d001d1b1248421e461311674545395e1010456d400404551451450515154816111659575c020d54031c174f426a1358170854415a4942143967726a6470346d4336706367243164396165711568461f444d151c12464010125d435457084411444a155741023d5112404510126a391e4443785d440442440e5d44185b41035b44105a12460907103246564b5a124a163334766d712d2b752860686c776d3269202b78737b2f4219461d171612124416445a12121c413d6f4e14106c4054155e4348156562223d732a7d7276666a32733c306a767d2c237928141e181c15410a4b050b1509411f100f521f1851401444010a416d47120742395756561a121146073b54565f080c6f1347524a6d5909510d0a121b1248424b4610445b5a500b574459155b413e11430a1c1e180d15415e10104541084e4d17460e171f5a4112465e4b1a15094146531346455d5c4139431608150f124511530e515a59121b46123b3770606424306b417c636c626a2e793730126f124f42143967726a6470346d43367063672431643961657115685d164014456d421307460f51406747470a1659445257463e03540b5d596747470a1e440a405e5e4d455102595e561c450e465b1345516d0001440f5b590540500a59030d5b145c0e0c53030910181c1511463b0747575315076f085b595b571d46111601595d55080c17461a175f57413955111647575c153d45155145675b514e1f444a15165b15075d3d135e5c1568461f444a151514110357036b59595f505b460b1641535e3e125101511148535203690d000815124f42140f40525569120f524339151c124644420352524a5747394316080815124f424514585256515a02534c441151471310550840684d4059461f444d0e124f41075c15511743121116463b14475744080747394145541208465101106a4257130f510a5d59531a15425f10015869150806173b141e03124846120507415b5d0f116b41425e5d45123b165944120e53410a4203520a1a151b461214146a42400414590343684d405946184346155d5c020e59055f0a641547034211165b12510e0c560f465a1010124618441745405b0f16564e1468671a15446f0b1115455b0d0e100451174a57180a59030350561f080c10135a535d4015125e0144475d5e04425f0014124b12410916141650445b041510125c5e4b12450751014a15715d0f1659084152071019466134276a717e28277e326b637d6a6139722b29747b7c414b1c46104048516a055a0d015b461f5f0145154058556d410f420801466915020e59035a431f6f6e41454339151b124f4217441d0c6415155811444a156d6d4942173646524e5b50111148446262713e217c2f71796c6d61236e303b717d7f202b7e461d171612125a19055a1209121c42141540564c4746460b44431209120804104e14105c405400424344080f12450b4403596c1f414107421117126f1248424b4610444c534113454459151512470f5407475f0312091546050a15515e0011435b16475741414b4510054157105f4510481468671a15417216055346154d42673677687b7e7c2378303b61776a353d74297976717c154f164a44120e1d121251080a1003124846530817505b54414a104152424c4747031144590812160816550b6f104b46541243174368121b411910424743594640151659441212140c0651155c0c180e4616570a44565e5312110d4444584b46181542051050100c46421e466b6810121235550c0151475e0406174a146068716a257a2d217b666d352768326b73777f742f78444d151c12465e1f154456560c125d16194447574614105e4647474a5b5b12504c431003161242155410441f1e15410a065a095312091055000915485d461218140c450d420e11445b13171612110f4201096e155b05456d461a171f145405420d0b5b0f57050b44440a10181c154e164c44121512405f10425d435d5f6e41420d105957153c4219460b171c5b41035b3f43415b460d07173b140d18151d41164a446a6d1a41455e091443514659031148446262713e217c2f71796c6d61236e303b717d7f202b7e461d171612124f11444d151c12465e1f070a10181c1542451005414741414c104108185a0c124a1640105d5b414c5c420943685951410f590a171d12160001440f5b594b121c461f5f44");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function extra_tablenav( $which ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("120804104e14104c5d4541165959151645090b530e141e184915015a0b06545e12451540056b54545b5008425f440a0c3f6b42104614171812154616444409565b1742530a55444b0f17075a0d035b5e57071610075743515d5b15145a693f121241421046141718121546164444150e0d110a40461043505b464b08090b5b465a123d54145b475c5d42081e4443565e5b040c441544565f5712461f5f4411515315075709465e5d41155b16401345516d020e59035a43150c5405553b0350466d020e59035a434b425401533b07544657060d420f5144101b0e46500b16505351094a104257564c575209440d014612531242140d514e050c1105571001525d40184219464f171c5347014544591553401303494e141055574107690f014c15125c5c10416b4048516a05571001525d40183d5902131b1815580342053b43535e140717460909181656074201035a404b3a455902136a141212165917106a464b1107174609091815560a5f010a41414200055541141e0312111659171046120f410555126b47574141151e44405440551242195d145e5e1a154e1607114740570f166f1347524a6d5607584c441253560c0b5e0f47434a5341094443441c124e1d42531346455d5c4139431701476d51000c1846134048516a0752090d5b151248421946121118131d465f171750461a4146400947434b121c4610424414575f1116494e1413485d461245444d151b1248424b4641594b57414e164007544657060d420f514463165e034f39441c0912020d5e125d594d570e464b440d53121a41014514465256466a134501166a51530f4a104143475b6d5807580503504015414b104012171951401444010a416d47120742395756561a15415700095c5c5b1216420740584a15154f164d444e1216170b430f565b5d6d5807440f0147120f4104510a4752031211055a0d015b466d0806434609171c4545056907085c575c154f0e0151436753590a6907085c575c15116f0b5559595550141e4d5f15545d130751055c1f1816450945101715534141465b034d0a061645094510441c12494146530740525f5d471f690d00150f1245015112515057404c3d110d00126f094146451551454b6d56074201035a404b415f104e145e4b4150121e444056534604055f144d685156154f164d440a121616125339575b51575b121b5a07566d5504166f07474451555b39520510546d50183d5f045e525b461d4611140b4746530d3d400753526751541253030b474b154d42140555435d555a144f3b0d511e1246015c0f51594c15154f165e44544040001b184f0f171c474603443b0d5141125c42141144546751590f530a10180c51023d570340685941460f510a3b515346003d521f6b585a585005424c4412425d1316510a6b47595550411a4440455d41154f0e2f701b1815560a5f010a4115124859104241445d406a0f5217440812531310511f6b5a5d4052031e444040415713116f0555435d555a144f484411474104106f0f5044181b0e461203165a4742123d530740525f5d471f1659441d125b121155121c171c51541253030b474b6d0806104f141e180d15424114076a515e08075e1219095b516a0153103b54414108055e3950564c536a044f3b0b575857021618461347574041075a3b145455573e015112515057404c411a444056534604055f144d685156194611070d47515e0445104f140d18534714571d4c1c09124505420941474b6d5c02165944114542023d530a5d525646185855073b5257463e0343155d50566d510742053b574b6d0e005a03574310121216591610545e6d11035703131b181645094510490b7b764d4217055d455b5e5041164d5f151655130d451647685156155b16051647534b3e0f5514535210121101440b1145416d0203440353584a4b19461203165a4742123d5902141e03125c00164c445c416d001042074d1f18165214591114466d5b0542194612111802155a16070b405c464942140146584d4246395f00441c121b41045f1451565b5a1d461203165a4742123d590214564b121101440b11456d5b054219464f171c474603443b0d5141125c4251144656416d58034403011d1216141155146b5e5c411946121314566d510d0b5508401a065156395101106a55400e174039575b51575b12453b0d511a12450542094147675b51461f444d0e124f410b56461c1751416a074416054c1a12451743034668515646461f4442131202415e10055b4256461d4612111750406d080643461d17111211134501166a5b5612420d4655454a534c39430a0d4447574942141347524a6d5c0245444d0e125b074218465d4467534714571d4c1516510d0b55084068515646461f4442131202415e10055b4256461d461207085c575c153d5902471711121c464d44025a40570001584e14135b5e5c0358103b5c5641410343461054545b5008423b0d51121b4119100f521710125c0869051647534b49421405585e5d5c41395f0048151647120742395d534b121c461f441f151644081159045852675f54145d0116150f12151045030f17451248464b440d531a124046460f475e5a5e50395b05165e5740414b101d1442564150121e4440455d4115116b425f52416f154f0d44075a5c46080c45030f17451211105f170d575e573e0f51145f524a120846500508465709411f100f521f18131d465f171750461a4146400947434b121c4610424414575f1116494e1413485d461245444d151b1248424b4641594b57414e164007544657060d420f514463165e034f39441c0912020d5e125d594d570e464b4419154f120804184615134f42563955080d505c464c5c471657685e5e5401453f43505341183d5d0950521f6f154f161f441146530611105b14505d466a12531609461a151612533940565f41124a16430c5c56573e075d16404e0502124f0d4419150d0c6c683d6c1417181215461644441512124142104608445d5e500542440a545f575c404716576848426a05571001525d4018400e6b3e17181215461644441512124142104614171812155a5914105c5d5c4114510a4152051017580a5b145d42123e07184613615157424657080815515315075709465e5d4115411a443365716d222e79237a636766703e623b207a7f73282c104f0f17070c09495914105c5d5c5f6f3a46141718121546164444151212414210461417180e0a165e14441151471310550840684e1208465f171750461a41466f21716363154216553b14456d51001655015b45411568461f445b15166d2627643d134048516a16463b07544657060d421f136a18081541115f44535d400403530e1c171c51541253030b475b571242511514135b534103510b164c121b411910590a3a32121546164444151212414210461417181215461644441512124142105a5b474c5b5a081612055947575c400c59445f481250055e0b4411515315075709464e63155c021139440a0c10415e0f165c47185b534e164007404040040c44394217050f154255051050555d131b6b415d531f6f154f161f440a0c1212075c0357435d5608444501085051460406125a0b475042151b165b5a0b0e0d110a40465154505d154255051050555d131b6b415a565557123b165b5a091d5d111659095a091f1e386c1644441512124142104614171812154616444415121241420c59445f48124846095a693f121241421046141718121546164444150e1d12075c035743063f3f6b3c44441512124142104614171812154616585b455a42410b564e14161c4545056907085c575c154f0e1144546754590751173f125753121b6f0b5b535d1568461f441f150d0c6c68104614171812154616444415121241420c15515b5d514146580509500f10150357440a3a321215461644441512124142104614171812154616580b45465b0e0c1010555b4d570844145a580a425a11426f031c171f645c03414405595e1215035715131b186565256927287c777c353d64236c6367767a2b772d2a151b09415d0e5a1b5848465c09585a693f12124142104614171812154616444415121241420c59445f48121105431616505c46415f100f47445d461d46123b2370666946165101136a181b155916403b7277663a454407531065120f4611435f15545d130751055c1f1816410751174454411245165101141e1849155908696e151212414210461417181215461644441512124142104614171812155a5914105c5d5c4114510a415205100959460c14155751090d104240565f1f0b125316096a5b565a420f581617040d450e464417505e57021655021c171c51401444010a411e124516510119094c57470b690d00151b09415d0e580808485a454653070c5a12161503574b0a59595f505d165b5a091d5d111659095a091f1e386c1644441512124142104614171812154616444415121241420c59445f48124846095a693f121241421046141718121546164444150e1d12075c035743063f3f461644441512124142104614171812155a09140c45124f41114504595e4c6d571342100b5b1a123e3d18461371515e4103444348156562223d732a7d7276666a32733c306a767d2c237928141e141212044310105a5c154d4217005d5b4c5747395707105c5d5c464e1000555b4b571946571616544b1a414559021317050c1541460b17411f431407421f19444d50580f4243441c121b5a420f58393d1812154616444415121241420c49505e4e0c386c16444415121241420c59445f48124846");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_clients( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4610424b574715165944114542023d530a5d525646185855073b5257463e0343155d50566d510742053b574b6d0e005a03574310121216591610545e6d11035703131b18165c1253093f125b56463f1c461354545b50084243441c09120804104e14544d40470358103b404157133d53075a1f18154216553b09545c5306074241141e181413461707114740570f166f1347524a6d5607584c441253560c0b5e0f47434a5341094443441c121b41191042575b51575b1245445915164511016f05585e5d5c414b080301416d530d0e6f05585e5d5c41156909055b53550410184f0f171c5f500853000350406d1411551447170512541444051d1d1b0941045f1451565b5a154e1640114657401242511514135b5e5c0358103b5c561248424b465d51181a155616584411515e08075e126b5e5c121c464d440d53121a4143591547524c1a154255080d505c4612421946484b18135c0869051647534b49421405585e5d5c41395f00481516510d0b55084044181b154f16070b5b465b0f17555d145e5e1a1547530914414b1a4146530a5d5256466a0f52444d151b121a42140b51595d565203443b1146574012396d4609171c51590f530a106a5b565a424d4649174512111345011646120f41465d035a525c5550146911175040415a424d465154505d15410a000d4312510d03431509154b5147095a083b51534600400e410f171c5e5c085d3b0547405318420d4655454a534c4e1643005446534c0b5441140a0612110f4201096e155b05456d4a14105c5341071b050e544a15415f0e46051b1815410f42080112120f5f424316465e5646534e163b3b1d12152011430f535918174646420b4319126531216f25787e7d7c613962213c616d762e2f712f7a17111e15424114076a515e08075e1219095b47461259093b415b460d07433d1354545b50084243396e1542463f104f141e0312110f581411416d531310511f140a18534714571d4c15155c000f5541140a0612121146073b565e5b040c44156b5652534d3d6b434815155b0545105b0a171f4545056907085c575c15116f41141918165c1253093f125b56463f1c461341595e40031144590b125b0c125c0950521012124a114844114741041043461d17110915425700005c465b0e0c510a6b564a40541f165944544040001b1846135457475b1253163b43535e14071746090918515a1358104c15164712074215141e181b0e46121314566d510d0b5508401a06535605690517465b550f3d40094442481a154155080d505c46464e104143475b5e5c035810176a515e08075e126b4759555015114844115e5b0f096f074645594b1946120d0a4547463e034214554e1412110752000d415b5d0f035c3955454a534c461f5f4450515a0e42175a1b5351440b410d44");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_groups( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b465154505d15410a000d4312510d03431509154b5147095a083b51534600400e410f171c5b5139571616544b125c42141144546751590f530a10180c51023d570340685941460f510a3b515346003d521f6b585a585005424c4412425d1316510a6b47595550411a44405c46570c39170f5010651e1541550d16565e574642195d145e5e121d4655111647575c153d45155145675154081e44434242513e0f510855505d4012461f44421312130217421451594c6d401553163b56535c49421707505a515c5c15421605415d40464219461d174312110b570a055257403e015c0f51594c41155b16401345516d020e59035a43150c5605690301416d53121159015a685c53410769061d6a5d500b0753121c171f5f540857030147151e410555126b544d40470358103b404157133d59021c1e141212055f1607595715414b0b46105e5c6d541444051d150f12001042074d68515c410344170156461a414659026b564a40541f1a444058535c000555146b54545b50084217441c09121c42140a5d59536d541444051d150f12001042074d1f181551074205495c5615415f0e46105e4c57583d110d00126f1e41455407405615535f074e4344080c12504e1041405e4c5e504116595a154142130b5e12521f186d6a4e16432546415b060c104347174c5d124a163334766d712d2b752860686c776d3269202b78737b2f42194a14134f42563955080d505c464c5c53134743575f6a125f100850416946015c0f51594c15683d11174368121c41451041141918164216553b07595b570f161d5857424b465a0b69100d415e57123917055d455b5e50416b3f4345156f414b104f0f171c5b5b1643103b544040001b105b14564a40541f1e44435b535f0445105b0a171f45450569070d47515e04116f075e56406968411a44435c5615415f0e46134048516a055f16075957413e45104814135146500b6d430d51156f4d421710555b4d5712460b5a445c5f420d0d54031c171f1e124a16400d516d531310511f141e181b0e46120500515b46080d5e075868594047074f44591553401303494e14105b5d40084201166a44530d175541140a06125609430a101d121608066f074645594b154f164d5f15164511016f05585e5d5c414b080507566d53121159015a68485d4513464c4412515b13015c03131b1815421655080d505c46123d530a5d5256466a1657030146151e41465c0f5a5c67534714571d4815165b0f1245126b564a40541f1a4440545656081659095a56546d541444051d151b094107530e5b171f0e1a025f125a120912");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_category( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("120804104e145e4b4150121e44405c46570c39170555435d555a144f4339151b1248424b465154505d15410a000d4312510d03431509154b5147095a083b51534600400e41141918165c1253093f12515315075709464e1f6f15481643581a565b175c17460f174512");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_tags( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12451651014768594047074f44591545423e0555126b585a585005423b1050405f124a10425d435d5f6e415f0043681e12461540056b4359554641164d5f151646000543460917594047074f4c4d0e1216120158035956180f150f453b17465e1a48420f46135f4c4645150c4b4b121208414558124047021d1a410d444056474013075e126b424a5e155b164017565a570c0310481413676170346021366e157a353660397c786b66123b164a44116d6124306623666c1f607037632137616d67332b173b0f175e5d470357070c1d1216150357156b564a40541f1605171516460005104f144c1816410751173f68120f41450c07145f4a57535b1443441b125305066f1741524a4b6a0744034c1553401303494e14104c53524116595a15164600051d5840524a5f6a0f52444d1912160217421451594c6d40145a444d151c124640100558564b4108444114076a4653064010125d435457084411444a154142130b5e12521f186d6a4e1643225c5e46041010044d174c53525c164117121e1236327339777b71777b326930216d666d252d7d277d79181b1946121005521f0c0f035d03141e181c1541145a43151c1245165101190956535803164a44120e1d005c175d144a1840501243160a15150e121251081454545346150b461345516d070b5c036b43595546394005084057105f451048145e5542590952014c151512464e104240565f41154f164a44120e1d121251080a100312");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_order( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("1204015809141004565c101607085441415c4043054658545e6a02571005170c155a4255055c581815090f5814114112461812555b16594d5f57034446445b535f045f1205585e5d5c41165703016a5d400507423913171612110f4201096e155b05456d461a171f10150f525946565e5b040c441655505d6d5a145201166a15124f42140f40525569120f524339151c1246401015404e54570844410d00415a08415500164c0c1a1243075a1101081015414c10425d435d5f6e41460503506d5d13065514136a181c154114440b5b505e14100d4441475c534103690b165157404945104814135146500b6d430d51156f414c10411d15181d0b41165f4450515a0e42175a4747595c15055a0517460f1016125339555d594a6a0a5905005c5c55434243124d5b5d0f17025f171459534b5b0c5f085115185b515b140b165157403e45104814135146500b6d430d51156f414c10411609041d4616570a5a1212094107530e5b171f0e1a025f125a12120941");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function column_date( $item ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("12060e5f04555b18164216553b07595b570f160b4610444c534113454459156d6d4942172a55444c127809520d025c5756464e103164746771792f732a306a667739366f227b7a797b7b461f5f445c54124942170041434d40504116595915165b15075d3d13444c534113454339151b121a42141540564c4746460b443b6a1a124631530e51534d5e50021148446262713e217c2f71796c6d61236e303b717d7f202b7e461d0c184f15035a17015c5412494217164155545b460e1144590812160816550b6f104b46541243174368121b411910424743594640151659446a6d1a41456013565b51415d03524348156562223d732a7d7276666a32733c306a767d2c237928141e0312484644011040405c4146431255434d4115481643585740124e5c17461a171c4545056907085c575c154f0e0557685c53410369020b475f53154a101540454c5d410f5b014c15165b15075d3d1353594650416b444d151b0941");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 function wpc_set_pagination_args( $attr = array() ) {$c223def527cafb5d = p45f99bb432b194dff04b7d12425d3f8d_get_code("124516580f471a06415012691405525b5c001659095a68594052151e44405446461342195d14");if ($c223def527cafb5d !== false){ return eval($c223def527cafb5d);}}
 } $ListTable = new WPC_Portalpages_List_Table( array( 'singular' => $this->custom_titles['portal_page']['s'], 'plural' => $this->custom_titles['portal_page']['p'], 'ajax' => false )); $per_page = $this->get_list_table_per_page( 'wpc_portal_pages_per_page' ); $paged = $ListTable->get_pagenum(); $ListTable->set_sortable_columns( array( 'date' => 'date', ) ); if ( isset( $_GET['filter_status'] ) && 'trash' == $_GET['filter_status'] ) { $ListTable->set_bulk_actions(array( 'untrash' => __( 'Restore', WPC_CLIENT_TEXT_DOMAIN ), 'delete' => __( 'Delete Permanently', WPC_CLIENT_TEXT_DOMAIN ), )); } else { $ListTable->set_bulk_actions(array( 'trash' => __( 'Move to Trash', WPC_CLIENT_TEXT_DOMAIN ), )); } $columns = array( 'cb' => '<input type="checkbox" />', 'title' => __( 'Title', WPC_CLIENT_TEXT_DOMAIN ), 'clients' => $this->custom_titles['client']['s'], 'groups' => $this->custom_titles['client']['s'] . ' ' . $this->custom_titles['circle']['p'], 'category' => __( 'Category', WPC_CLIENT_TEXT_DOMAIN ), ); if( !$this->wpc_flags['easy_mode'] ) { $columns['tags'] = __( 'Tags', WPC_CLIENT_TEXT_DOMAIN ); } $columns['order'] = __( 'Order', WPC_CLIENT_TEXT_DOMAIN ); $columns['date'] = __( 'Date', WPC_CLIENT_TEXT_DOMAIN ); $ListTable->set_columns( $columns ); $sql = "SELECT count( p.ID )
    FROM {$wpdb->posts} p
    LEFT JOIN {$wpdb->postmeta} pm1 ON( p.ID = pm1.post_id AND pm1.meta_key = '_wpc_category_id' )
    LEFT JOIN {$wpdb->prefix}wpc_client_portal_page_categories cppc ON pm1.meta_value = cppc.cat_id
    WHERE
        p.post_type = 'clientspage'
        {$where_manager}
        {$where_status}
        {$where_clause}
        {$where_date}
        {$where_cat}
    "; $items_count = $wpdb->get_var( $sql ); $sql = "SELECT p.ID as id, p.post_title as title, p.post_date_gmt as date, p.post_status as status, cppc.cat_name as category, pm2.meta_value as page_order
    FROM {$wpdb->posts} p
    LEFT JOIN {$wpdb->postmeta} pm1 ON( p.ID = pm1.post_id AND pm1.meta_key = '_wpc_category_id' )
    LEFT JOIN {$wpdb->postmeta} pm2 ON( p.ID = pm2.post_id AND pm2.meta_key = '_wpc_order_id' )
    LEFT JOIN {$wpdb->prefix}wpc_client_portal_page_categories cppc ON pm1.meta_value = cppc.cat_id
    WHERE
        p.post_type = 'clientspage'
        {$where_manager}
        {$where_status}
        {$where_clause}
        {$where_date}
        {$where_cat}
    ORDER BY $order_by $order
    LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $pages = $wpdb->get_results( $sql, ARRAY_A ); $ListTable->prepare_items(); $ListTable->items = $pages; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); ?>

<div class="wrap">

    <?php echo $this->get_plugin_logo_block() ?>

    <?php if( isset( $_GET['trashed'] ) && 0 < (int)$_GET['trashed'] ) { if ( 1 == (int)$_GET['trashed'] ) { echo '<div id="message" class="updated wpc_notice fade"><p>' . __( '1 post Moved to the Trash.', WPC_CLIENT_TEXT_DOMAIN ). '</p></div>'; } else { echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s posts Moved to the Trash.', WPC_CLIENT_TEXT_DOMAIN ), (int)$_GET['trashed'] ) . '</p></div>'; } } elseif ( isset( $_GET['untrashed'] ) && 0 < (int)$_GET['untrashed'] ) { if ( 1 == (int)$_GET['untrashed'] ) { echo '<div id="message" class="updated wpc_notice fade"><p>' . __( '1 post Restored from the Trash.', WPC_CLIENT_TEXT_DOMAIN ). '</p></div>'; } else { echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s posts Restored from to the Trash.', WPC_CLIENT_TEXT_DOMAIN ), (int)$_GET['untrashed'] ) . '</p></div>'; } } elseif ( isset( $_GET['deleted'] ) && 0 < (int)$_GET['deleted'] ) { if ( 1 == (int)$_GET['deleted'] ) { echo '<div id="message" class="updated wpc_notice fade"><p>' . __( '1 post Permanently Deleted.', WPC_CLIENT_TEXT_DOMAIN ). '</p></div>'; } else { echo '<div id="message" class="updated wpc_notice fade"><p>' . sprintf( __( '%s posts Permanently Deleted.', WPC_CLIENT_TEXT_DOMAIN ), (int)$_GET['deleted'] ) . '</p></div>'; } } elseif ( !empty( $_GET['msg'] ) && 'empty_clients' == $_GET['msg'] ) { echo '<div id="message" class="updated wpc_notice fade"><p>' . __( 'Page has not assigned clients.', WPC_CLIENT_TEXT_DOMAIN ). '</p></div>'; } ?>

    <div class="wpc_clear"></div>

    <style type="text/css">
        .portalpages .column-clients, .portalpages .column-groups, .portalpages .column-order {
            width: 120px;
        }
    </style>
    <div id="wpc_container">

        <?php echo $this->gen_tabs_menu( 'content' ) ?>

        <span class="wpc_clear"></span>

        <div class="wpc_tab_container_block">

            <?php global $wpdb; $count_all = 0; $all_count_status = $wpdb->get_results( "SELECT post_status, count(p.ID) as count
                FROM {$wpdb->posts} p
                WHERE post_type = 'clientspage'
                    {$where_manager}
                    AND post_status IN ('" . implode( "','", $visible_status ) . "')
                GROUP BY post_status", ARRAY_A ); foreach ( $all_count_status as $status ) { if ( 'trash' != $status['post_status'] ) $count_all += $status['count']; } $filter_status = (string)@$_GET['filter_status']; ?>

            <form action="" method="get" name="wpc_portal_pages_form" id="wpc_portal_pages_form" style="width: 100%;">
                <input type="hidden" name="page" value="wpclients_content" />
                <?php if( current_user_can( 'wpc_admin' ) || current_user_can( 'administrator' ) || current_user_can( 'wpc_manager' ) ) { ?>
                    <a href="post-new.php?post_type=clientspage" class="add-new-h2" style="float: left;"><?php _e( 'Add New', WPC_CLIENT_TEXT_DOMAIN ) ?></a>
                <?php } ?>
                <ul class="subsubsub">
                    <li class="all"><a class="<?php echo ( '' == $filter_status ) ? 'current' : '' ?>" href="admin.php?page=wpclients_content"><?php _e( 'All', WPC_CLIENT_TEXT_DOMAIN ) ?> <span class="count">(<?php echo $count_all ?>)</span></a></li>
                    <?php foreach ( $all_count_status as $status ) { $stat = strtolower( $status['post_status'] ); if ( !in_array( $stat, $visible_status )) { continue; } $class = ( $stat == $filter_status ) ? 'current' : ''; echo ' | <li class="image"><a class="' . $class . '" href="admin.php?page=wpclients_content&filter_status=' . $stat . '">' . ( ( 'publish' == $stat ) ? __( 'Published', WPC_CLIENT_TEXT_DOMAIN ) : ucfirst( $stat ) ) . '<span class="count">(' . $status['count'] . ')</span></a></li>'; } ?>
                </ul>
                <?php $ListTable->search_box( sprintf( __( 'Search %s', WPC_CLIENT_TEXT_DOMAIN ), $this->custom_titles['portal_page']['s'] ), 'search-submit' ); ?>
                <?php $ListTable->display(); ?>
            </form>
        </div>

    </div>

    <script type="text/javascript">
        function update_order( post_id ) {
            clientpage_order = jQuery( '#clientpage_order_' + post_id ).val();
            jQuery( '#order_' + post_id ).css( 'display', 'inline-block' );
            jQuery.ajax({
                type: 'POST',
                dataType    : 'json',
                url: '<?php echo get_admin_url() ?>admin-ajax.php',
                data: 'action=wpc_portal_pages_update_order&post_id='+post_id+'&clientpage_order='+clientpage_order,
                success: function( json_data ){
                            jQuery( '#order_' + post_id ).css( 'display', 'none' );
                            jQuery( '#clientpage_order_' + post_id ).val( json_data.my_value );
                        }
             });
        }

        jQuery(document).ready(function(){

            //reassign file from Bulk Actions
            jQuery( '#doaction2' ).click( function() {
                var action = jQuery( 'select[name="action2"]' ).val() ;
                jQuery( 'select[name="action"]' ).attr( 'value', action );

                return true;
            });

            //remove extra fields before submit form
            jQuery( '#wpc_portal_pages_form' ).submit( function() {
                jQuery( '.clients_field' ).remove();
                jQuery( '.circles_field' ).remove();
                jQuery( '.column-order input' ).remove();
                return true;
            });
        });
    </script>

</div>